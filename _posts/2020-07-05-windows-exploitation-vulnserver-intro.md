---
layout: single
title: Exploiting vulnserver.exe — Intro to Windows Exploitation
description: "In this multipart write-up, I will feature vulnserver.exe — a binary that is
  designed to be exploited."
header:
  teaser: "https://cdn-images-1.medium.com/max/800/1*1QKOaLrSOztHAkaJjH3aBQ.png"
date: '2020-07-05T15:04:08.146Z'
classes: wide
categories:
- exploitation 
- windows
tags:
- pwn
- windows-exploitation
- mona
- immunity-debugger
---

In this multipart write-up, I will feature [vulnserver.exe](http://www.thegreycorner.com/p/vulnserver.html)— a binary that is designed to be exploited. I used this binary to have a quick introduction on Windows exploitation development, since I am only familiar with exploiting Linux binaries.

For the test environment, I used Windows 7 x86 VM with the following tools:

*   [Immunity debugger](https://www.immunityinc.com/products/debugger/)
*   [Mona.py](https://github.com/corelan/mona)

![](https://cdn-images-1.medium.com/max/800/1*C-uWKx8m5Di_SSml9M9xag.jpeg){: .align-center}

![](https://cdn-images-1.medium.com/max/800/1*1QKOaLrSOztHAkaJjH3aBQ.png){: .align-center}

And of course, [vulnserver.exe](http://www.thegreycorner.com/p/vulnserver.html) as our victim binary.

![](https://cdn-images-1.medium.com/max/800/1*7bmgBpckTY2tg31mFzbL5Q.png){: .align-center}

By default, vulnserver listens on port `9999`.

![](https://cdn-images-1.medium.com/max/800/1*ZywFYFJa6DhKVY3BwVczIg.png){: .align-center}

The source code is also included upon downloading the compressed file, which helped me a lot in identifying the vulnerabilities of the program.

![](https://cdn-images-1.medium.com/max/800/1*Uw_cehfmg-QZEZYXEYaBGw.png){: .align-center}

Upon checking the source code, I have identified 6 vulnerable commands (out of 14) that could lead to stack-based buffer overflow. The vulnerable commands are as follows:

*   TRUN
*   GMON
*   KSTET
*   GTER
*   HTER
*   LTER

All these commands have a common culprit — `strcpy()`

> The `strcpy` built-in function does not check buffer lengths and may very well overwrite memory zone contiguous to the intended destination.

Which explains why all these commands are vulnerable to buffer overflow. The exploit for each command will be discussed separately.

*   [TRUN ( jmp esp )](/exploitation/windows/windows-exploitation-vulnserver-trun-command/)
*   [GMON ( SEH )](/exploitation/windows/windows-exploitation-vulnserver-gmon-command/)
*   [KSTET ( jmp esp + egghunter )](/exploitation/windows/windows-exploitation-vulnserver-kstet-command/)
*   [GTER ( jmp esp + egghunter )](/exploitation/windows/windows-exploitation-vulnserver-gter-command/)
*   [HTER ( str2hex payload + jmp esp )](/exploitation/windows/windows-exploitation-vulnserver-hter-command/)
*   [LTER ( jmp esp + badchars bypass )](/exploitation/windows/windows-exploitation-vulnserver-lter-command/)

To mitigate this vulnerability, alternative functions like `strncpy()` should be used. There are a lot of resources online that can be used as a reference for secure coding. Below are some of the examples:

*   [https://rules.sonarsource.com/c/type/Vulnerability/RSPEC-5782](https://rules.sonarsource.com/c/type/Vulnerability/RSPEC-5782)
*   [https://security.web.cern.ch/recommendations/en/codetools/c.shtml](https://security.web.cern.ch/recommendations/en/codetools/c.shtml)
*   [https://medium.com/@int0x33/day-49-common-c-code-vulnerabilities-and-mitigations-7eded437ca4a](https://medium.com/@int0x33/day-49-common-c-code-vulnerabilities-and-mitigations-7eded437ca4a)

— ar33zy
